<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MINIMAL PORTAL TEST</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>MINIMAL PORTAL TEST</h1>
    <p>This page contains ONLY the essential supabase code that's causing issues.</p>
    <div id="status">Loading...</div>

    <script>
        console.log('MINIMAL TEST: Starting...');
        
        // The exact configuration from the portal
        const SUPABASE_URL = 'https://mvftaaxgdygeyzcvzqfr.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im12ZnRhYXhnZHlnZXl6Y3Z6cWZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2MjI3OTQsImV4cCI6MjA3NDE5ODc5NH0.nj5c_AAEg4U2qlcE1vQDMWt0nfXpmUYR1lrTR6KCIDY';

        try {
            // Test 1: Basic initialization (what SHOULD work)
            console.log('MINIMAL TEST: Creating first client...');
            const supabase1 = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('MINIMAL TEST: ✅ First client created successfully');
            
            // Test 2: Second initialization (where it might break)
            console.log('MINIMAL TEST: Creating second client...');
            const supabase2 = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('MINIMAL TEST: ✅ Second client created successfully');
            
            // Test 3: The exact pattern from your portal
            console.log('MINIMAL TEST: Testing portal pattern...');
            let supabase;
            if (typeof window !== 'undefined' && window.supabase) {
                if (typeof window.globalSupabase === 'undefined') {
                    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    window.globalSupabase = supabase;
                    console.log('MINIMAL TEST: ✅ Portal pattern - first initialization');
                } else {
                    supabase = window.globalSupabase;
                    console.log('MINIMAL TEST: ✅ Portal pattern - reusing existing');
                }
            }
            
            // Test 4: Try portal pattern again (should reuse)
            let supabase_second_attempt;
            if (typeof window !== 'undefined' && window.supabase) {
                if (typeof window.globalSupabase === 'undefined') {
                    supabase_second_attempt = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    window.globalSupabase = supabase_second_attempt;
                    console.log('MINIMAL TEST: ✅ Portal pattern - second attempt new');
                } else {
                    supabase_second_attempt = window.globalSupabase;
                    console.log('MINIMAL TEST: ✅ Portal pattern - second attempt reused');
                }
            }
            
            document.getElementById('status').innerHTML = 
                '<h2 style="color: green;">✅ ALL TESTS PASSED</h2>' +
                '<p>Supabase initialization works perfectly on this device.</p>' +
                '<p>The issue must be elsewhere in the full portal code.</p>';
            
            console.log('MINIMAL TEST: ✅ ALL TESTS COMPLETED SUCCESSFULLY');
            
        } catch (error) {
            console.error('MINIMAL TEST: ❌ ERROR CAUGHT:', error);
            
            document.getElementById('status').innerHTML = 
                '<h2 style="color: red;">❌ ERROR FOUND</h2>' +
                '<p>Error: ' + error.message + '</p>' +
                '<p>This is the exact error Ahmad gets!</p>';
        }
        
        console.log('MINIMAL TEST: Script completed');
    </script>
    
    <div style="margin-top: 20px; padding: 10px; border: 1px solid #ccc;">
        <h3>Instructions for Ahmad:</h3>
        <ol>
            <li>Open browser console (F12)</li>
            <li>Look for "MINIMAL TEST" messages</li>
            <li>Take screenshot of console</li>
            <li>Take screenshot of this page</li>
            <li>Send both to admin</li>
        </ol>
        <p><strong>Expected:</strong> Green "ALL TESTS PASSED" message</p>
        <p><strong>If error:</strong> Red error message with exact details</p>
    </div>
</body>
</html>
